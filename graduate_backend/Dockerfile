FROM node:23-slim

WORKDIR /app

# Copy package.json and yarn.lock
COPY package.json yarn.lock ./

# Install dependencies
RUN yarn install

# Copy app source
COPY . .

# Expose the API port
EXPOSE ${PORT:-4000}

# Use a shell form CMD to run your logic before starting the app
CMD set -e; \
    if [ "${SEED:-false}" = "true" ]; then \
        echo "ðŸŒ± Seeding database..."; \
        node utils/seedDatabase.js; \
        echo "âœ… Database seeding complete."; \
    fi; \
    exec yarn start
